;; PgBouncer configuration for SOAR
;; See: https://www.pgbouncer.org/config.html

[databases]
; Production database - soar user connects to soar database
; user= forces the backend connection to use 'soar' user
soar = host=127.0.0.1 port=5432 dbname=soar user=soar

; Staging database - soar user connects to soar_staging database
soar_staging = host=127.0.0.1 port=5432 dbname=soar_staging user=soar

; Development database - soar user connects to soar_dev database
soar_dev = host=127.0.0.1 port=5432 dbname=soar_dev user=soar

[pgbouncer]
; Connection settings
listen_addr = 127.0.0.1
listen_port = 6432
unix_socket_dir = /var/run/postgresql

; Authentication
; Use 'any' auth since we only listen on localhost and force the backend user
; This is safe because listen_addr is 127.0.0.1 only
auth_type = any

; Pool settings
; transaction - release connection after each transaction (good for web apps)
pool_mode = transaction

; Maximum client connections
max_client_conn = 1000

; Default pool size per database/user pair
default_pool_size = 100

; Minimum pool size - keep this many connections open
min_pool_size = 10

; Reserve pool - extra connections for sudden bursts
reserve_pool_size = 10
reserve_pool_timeout = 3

; Connection limits
max_db_connections = 120
max_user_connections = 120

; Timeouts (seconds)
server_connect_timeout = 15
server_idle_timeout = 600
server_lifetime = 3600
client_idle_timeout = 0
client_login_timeout = 60
query_timeout = 0
query_wait_timeout = 120

; Logging
log_connections = 0
log_disconnections = 0
log_pooler_errors = 1
stats_period = 60

; Admin settings
admin_users = postgres
stats_users = postgres,soar

; Process settings
pidfile = /var/run/pgbouncer/pgbouncer.pid
logfile = /var/log/pgbouncer/pgbouncer.log

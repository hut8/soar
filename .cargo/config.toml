# Rust build configuration for faster compilation

[build]
# Incremental compilation (enabled by default for dev, but explicit here)
incremental = true
# Enable tokio_unstable for tokio-console support
# Enable frame pointers for profiling (pprof stack unwinding)
rustflags = ["--cfg", "tokio_unstable", "-C", "force-frame-pointers=yes"]

[target.x86_64-unknown-linux-gnu]
# Using default linker (ld)
# Note: mold was previously configured here but is not currently used

[target.x86_64-unknown-linux-musl]
# Static linking configuration for musl
rustflags = [
    "--cfg", "tokio_unstable",
    "-C", "force-frame-pointers=yes",
    "-C", "target-feature=+crt-static",
    "-C", "link-arg=-static",
]

[target.aarch64-unknown-linux-musl]
# Static linking configuration for musl (ARM64)
rustflags = [
    "--cfg", "tokio_unstable",
    "-C", "force-frame-pointers=yes",
    "-C", "target-feature=+crt-static",
    "-C", "link-arg=-static",
]

# Optimization flags for development builds
[profile.dev]
# Split debuginfo to reduce binary size and link time
split-debuginfo = "unpacked"  # Linux-specific, faster than "packed"

# Incremental compilation
incremental = true

# Reduce debuginfo in dependencies to speed up linking
[profile.dev.package."*"]
opt-level = 0
debug = 0  # No debug info for dependencies in dev builds

# Keep debug info for your own code
[profile.dev.build-override]
opt-level = 0
debug = 1
